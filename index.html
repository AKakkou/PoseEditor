<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>PoseEditor</title>

        <script src="bower_components/three.js/three.js" type="text/javascript"></script>
        <script src="build/poseeditor.js" type="text/javascript"></script>
        <script src="ext/TransformControls.js" type="text/javascript"></script>
        <script src="ext/OrbitControls.js" type="text/javascript"></script>

        <script src="http://code.jquery.com/jquery-2.1.1.js" type="text/javascript"></script>
    </head>
    <body>
        <div id="for_pose" style="width: 100%; height: 400px;"></div>

        <script type="text/javascript">
         var editor = null;

         function downloadImage() {
           // basic example
           if ( editor != null ) {
             var a = document.createElement("a");
             a.download = name;
             a.title = "download snapshot";

             var radio = document.getElementsByName("format");
             var format = "";
             for(var i=0; i<radio.length; i++) {
               if (radio[i].checked) {
                 format = radio[i].value
                 break;
               }
             }

             a.href = editor.toDataUrl(format);
             a.click();

             delete a;
           }
         }

         function loadSceneData() {
           // basic example
           if ( editor != null ) {
             var dom = document.getElementById("scene_data");
             editor.loadSceneDataFromString(dom.value);
           }
         }

         function toggleMarker() {
           // basic example
           if ( editor != null ) {
             editor.toggleMarker();
           }
         }

         function changeBGColorAndAlpha() {
           if ( editor != null ) {
             var color_dom = document.getElementById("bg_color");
             var alpha_dom = document.getElementById("bg_alpha");

             editor.setClearColor(parseInt(color_dom.value, 16), parseFloat(alpha_dom.value));
           }
         }

         function shareScene() {
           var address = 'http://yutopp.github.io/PoseEditor/';
           if ( editor != null ) {
             var target = address + '#' + encodeURIComponent(JSON.stringify(editor.getSceneInfo()));

             window.open("https://twitter.com/share?url=" + encodeURIComponent(target) + "&text=PoseEditorでポーズを作ったぞい！");
           }
         }

         $(function() {
           var config = new PoseEditor.Config();
           config.enableBackgroundAlpha = true;
           config.backgroundColorHex = 0x777777;
           config.backgroundAlpha = 1.0;
           sprite_paths = {
             normal: "images/marker.png",
             special: "images/square.png",
           };
           model_table = {
             "sport_man": {
               model_path: "models/model/model.js",
               texture_dir: "models/model/",
               ik_stop_joints: [32, 13, 1, 5, 9, 50, 12, 31, 22, 28, 25, 16, 19, 47, 41, 44, 38, 35],
             },
           };
           editor = new PoseEditor.Editor("for_pose", model_table, sprite_paths, config);
           if ( location.hash !== "" ) {
             try {
               var encoded = location.hash.slice(1);
               var json_string = decodeURIComponent(encoded);

               editor.loadSceneDataFromString(json_string);

             } catch(e) {
               console.warn(e);
             }

           } else {
             // default
             editor.appendModel("sport_man");
           }
         });
        </script>

        <textarea id="scene_data">{"camera":{"position":{"x":61.6443659543132,"y":38.909149535225126,"z":19.758795612315346},"quaternion":{"_x":-0.2159463138278646,"_y":0.5679448745158258,"_z":0.15755115861614336,"_w":0.7784493792839939}},"model":{"joints":[{"rotation":{"_x":0.646233,"_y":3.3199e-10,"_z":-9.09255e-18,"_w":0.76314}},{"rotation":{"_x":-0.8656527408355963,"_y":-0.11318199339765302,"_z":0.10715371798352727,"_w":0.4757659607166749}},{"rotation":{"_x":0.012607948611499217,"_y":-0.001524777866295208,"_z":-0.018161724908751436,"_w":0.9997544030573745}},{"rotation":{"_x":-0.537224,"_y":-0.0809431,"_z":0.114388,"_w":0.831718}},{"rotation":{"_x":-0.235404,"_y":0.0177122,"_z":0.00425326,"_w":0.971727}},{"rotation":{"_x":-0.9891,"_y":0.137045,"_z":-0.0365621,"_w":0.0395378}},{"rotation":{"_x":0.0770293,"_y":0.00276874,"_z":0.000210752,"_w":0.997025}},{"rotation":{"_x":-0.53734,"_y":0.0791709,"_z":-0.115476,"_w":0.831663}},{"rotation":{"_x":-0.232716,"_y":0.00319407,"_z":-0.00925451,"_w":0.972495}},{"rotation":{"_x":0.00767915,"_y":-2.48318e-9,"_z":2.10612e-9,"_w":0.999971}},{"rotation":{"_x":-0.0164624,"_y":2.24799e-9,"_z":-1.86996e-9,"_w":0.999865}},{"rotation":{"_x":0.233231,"_y":6.47561e-10,"_z":-5.38664e-10,"_w":0.972421}},{"rotation":{"_x":-0.706259,"_y":0.36948,"_z":-0.494654,"_w":0.346411}},{"rotation":{"_x":0.38772274138403284,"_y":0.2750723537668423,"_z":0.5426643423047337,"_w":0.6924750447473111}},{"rotation":{"_x":0.025976806133424138,"_y":-0.0029309511956240927,"_z":-0.17311397213052376,"_w":0.9845548068652084}},{"rotation":{"_x":0.132544,"_y":0.107952,"_z":0.673538,"_w":0.719114}},{"rotation":{"_x":-0.0555834,"_y":0.140396,"_z":-0.0158928,"_w":0.988406}},{"rotation":{"_x":0.109047,"_y":-0.0123902,"_z":-0.00404865,"_w":0.993951}},{"rotation":{"_x":-0.00834932,"_y":0.0251437,"_z":0.00491419,"_w":0.999637}},{"rotation":{"_x":0.045362,"_y":0.182065,"_z":0.0889915,"_w":0.9782}},{"rotation":{"_x":0.0680813,"_y":-0.00798434,"_z":-0.00519242,"_w":0.997634}},{"rotation":{"_x":0.0135893,"_y":0.0147897,"_z":0.00820109,"_w":0.999765}},{"rotation":{"_x":-0.0905757,"_y":-0.369519,"_z":0.644037,"_w":0.663677}},{"rotation":{"_x":0.116455,"_y":-0.000517121,"_z":-0.00401436,"_w":0.993188}},{"rotation":{"_x":0.0370254,"_y":-0.00358345,"_z":-0.00951937,"_w":0.999263}},{"rotation":{"_x":-0.0345541,"_y":0.0610855,"_z":-0.0174521,"_w":0.997382}},{"rotation":{"_x":0.0991333,"_y":-0.00557081,"_z":-0.00281954,"_w":0.995055}},{"rotation":{"_x":-0.00297076,"_y":0.0117477,"_z":0.00445022,"_w":0.999917}},{"rotation":{"_x":0.000169169,"_y":-0.0726416,"_z":0.213571,"_w":0.974223}},{"rotation":{"_x":0.0995171,"_y":0.00174617,"_z":0.00427811,"_w":0.995025}},{"rotation":{"_x":0.0160516,"_y":-0.00427745,"_z":-0.00808524,"_w":0.999829}},{"rotation":{"_x":-0.706259,"_y":-0.36948,"_z":0.494654,"_w":0.346411}},{"rotation":{"_x":-0.203354,"_y":-0.250779,"_z":-0.721418,"_w":0.612629}},{"rotation":{"_x":0.39378,"_y":4.12079e-8,"_z":-0.00000410947,"_w":0.919205}},{"rotation":{"_x":0.132544,"_y":-0.107952,"_z":-0.673538,"_w":0.719114}},{"rotation":{"_x":0.045362,"_y":-0.182065,"_z":-0.0889915,"_w":0.9782}},{"rotation":{"_x":0.0680813,"_y":0.00798434,"_z":0.00519242,"_w":0.997634}},{"rotation":{"_x":0.0135893,"_y":-0.0147897,"_z":-0.00820109,"_w":0.999765}},{"rotation":{"_x":-0.0555834,"_y":-0.140396,"_z":0.0158928,"_w":0.988406}},{"rotation":{"_x":0.109047,"_y":0.0123902,"_z":0.00404865,"_w":0.993951}},{"rotation":{"_x":-0.00834932,"_y":-0.0251437,"_z":-0.00491419,"_w":0.999637}},{"rotation":{"_x":0.000169169,"_y":0.0726416,"_z":-0.213571,"_w":0.974223}},{"rotation":{"_x":0.0995171,"_y":-0.00174617,"_z":-0.00427811,"_w":0.995025}},{"rotation":{"_x":0.0160516,"_y":0.00427745,"_z":0.00808524,"_w":0.999829}},{"rotation":{"_x":-0.0345541,"_y":-0.0610855,"_z":0.0174521,"_w":0.997382}},{"rotation":{"_x":0.0991333,"_y":0.00557081,"_z":0.00281954,"_w":0.995055}},{"rotation":{"_x":-0.00297076,"_y":-0.0117477,"_z":-0.00445022,"_w":0.999917}},{"rotation":{"_x":-0.0914642,"_y":0.3693,"_z":-0.645632,"_w":0.662126}},{"rotation":{"_x":0.116452,"_y":0.00100563,"_z":0.00462528,"_w":0.993185}},{"rotation":{"_x":0.0370136,"_y":0.00370355,"_z":0.00985419,"_w":0.999259}},{"rotation":{"_x":-0.16236,"_y":-8.74468e-10,"_z":9.42199e-10,"_w":0.986732}},{"rotation":{"_x":0.0247222,"_y":3.1436e-10,"_z":-3.17835e-10,"_w":0.999694}}]}}</textarea>
        <input type="button" value="シーンのロード" onClick="loadSceneData()">
        <input type="button" value="Twitterでシーンを共有" onClick="shareScene()">

        <br>

        <label><input type="radio" name="format" value="png" checked>PNG</label>
        <label><input type="radio" name="format" value="jpeg">JPEG</label>
        <label><input type="radio" name="format" value="json">JSON</label>
        <input type="button" value="ダウンロード" onClick="downloadImage()">

        <br>

        <label><input type="checkbox" id="toggle_marker" onClick="toggleMarker()" checked>マーカー</label>

        <br>

        <label>色<input type="text" id="bg_color" value="0x777777" onChange="changeBGColorAndAlpha()"></label>
        <label>アルファ<input type="text" id="bg_alpha" value="1.0" onChange="changeBGColorAndAlpha<script src="
    </body>
</html>
